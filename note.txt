è¸©å‘è®°å½•ï¼š
2bit 6bitéƒ¨åˆ†ï¼š

prepareåªä¼šåœ¨æˆModuleçš„å®ä¾‹ä¸‹æ·»åŠ observerï¼Œå› æ­¤Resnetå’ŒMobileNetV2ä¸­çš„shortcutç»“æ„åœ¨â€œåŠ â€çš„æ—¶å€™ä¸èƒ½ç›´æ¥åŠ ï¼ˆå¦åˆ™prepareå‡½æ•°ä¸çŸ¥é“åœ¨å“ªé‡Œæ·»åŠ observerï¼‰ï¼Œè€Œå¿…é¡»å®ä¾‹åŒ–ä¸€ä¸ªâ€œç®—æ•°ç±»â€ï¼ˆtorch.ao.nn.quantized.FloatFunctionalï¼‰ä½œä¸ºæ¨¡å‹æˆå‘˜ï¼Œç„¶åè°ƒç”¨è¯¥æˆå‘˜åšåŠ æ³•ã€‚ï¼ˆè¯¦è§ä»£ç å®ç°ä¸­arithæˆå‘˜ï¼‰

torch/quantization/observer.py:131: UserWarning: must run observer before calling calculate_qparams.                                    Returning default scale and zero point 
å¦‚æœpreparedçš„æ¨¡å‹ä¸­æœ‰çš„observeræ²¡æœ‰è¢«ä½¿ç”¨å°±ä¼šå‡ºç°æ­¤æ¡è­¦å‘Šã€‚å½“ç„¶ï¼Œç”±äºæ²¡æœ‰ä½¿ç”¨ç›´æ¥å¿½ç•¥è¿™æ¡è­¦å‘Šå°±è¡Œã€‚æœ¬å®éªŒä¸­é‡åˆ°çš„æƒ…å†µæ˜¯åœ¨æ²¡ä½¿ç”¨shortcutçš„blkä¸­ä¹Ÿæ„å»ºäº†ç®—æ•°ç±»ï¼Œprepareå‡½æ•°æ— åŒºåˆ«åœ°ä¸ºå…¶é™„åŠ äº†observerï¼Œä½†æ²¡æœ‰æ•°æ®æµè¿‡è¯¥observerå½“ç„¶å°±ä¸ä¼šç»Ÿè®¡åˆ°ä»»ä½•ä¸œè¥¿ï¼ˆmin=-infï¼Œmax=infï¼‰

ptsq fusionä¸­bnä¼šç›´æ¥æŠ˜ç®—åˆ°å…¶å‰/åçš„linearæˆ–convå±‚weightï¼Œå› æ­¤æ¶ˆå¤±ï¼›å¦‚æœå’Œactivation fusionåˆ™æ²¡æ³•æŠ˜ç®—ï¼Œå°±ä¼šä¿ç•™ã€‚æ³¨æ„qatä¸­fusionæ—¶ä¸èƒ½å¦‚æ­¤æ¶ˆå»bnï¼Œå› ä¸ºè¿˜éœ€è¦æ›´æ–°

bitæ•°åœ¨qconfigè®¾ç½®ï¼›å¦‚æœåªæ˜¯ä¸€åŠçš„8bitå¯ä»¥ç”¨é»˜è®¤è®¾ç½®ï¼Œæ³¨æ„ç”±äºå‘é‡æŒ‡ä»¤ç¡¬ä»¶å®ç°é—®é¢˜å…¶å®æ˜¯7bit

è¦åœ¨forwardæ’å…¥QuantStub()å’ŒDeQuantStub()å¦åˆ™Could not run 'quantized::conv2d.new' with arguments from the 'CPU' backend. This could be because the operator doesn't exist for this backend, or was omitted during the selective/custom build process (if using custom build).

scheduleræœ‰ç°æˆçš„ReduceLROnPlateauï¼Œé…åˆsgdå¥½ç”¨

fusionåªèƒ½é’ˆå¯¹éƒ¨åˆ†å›ºå®šç»„åˆï¼Œå·®ä¸€ç‚¹éƒ½ä¸è¡Œï¼›ä½†ç»´åº¦æ— æ‰€è°“ï¼Œå‚è§https://pytorch.org/tutorials/recipes/fuse.html

fusionåˆ—è¡¨ä¸­Sequentialçš„è¡¨ç¤ºæ–¹æ³•ï¼š[['XX.0','XX.1',...],...]ï¼Œå‚è§https://discuss.pytorch.org/t/fuse-modules-how-to-fuse-modules-in-the-sequential-block/140423

è¿™ä¸ªå®ç°æ²¡ç”¨fakequantizeï¼Œä½†å®é™…ä¹Ÿæ˜¯fakequantizeâ€”â€”ç”¨8bitæ•´æ•°æ¥æ¨¡æ‹Ÿæ›´ä½bitæ•°çš„æ•´æ•°ï¼›è¿™ä¸ªå®ç°ä¸­æ²¡æœ‰é‡åŒ–æ¢¯åº¦ï¼ˆå› ä¸ºæœ¬æ¥å°±æ˜¯ptqï¼‰

MobileNetä¸­convçš„groupç†è§£ï¼šhttps://discuss.pytorch.org/t/understanding-the-conv2d-groups-parameter/138951/2

torchçš„docå†™å¾—å…¶å®ä¸å¤ªå¥½ï¼Œæ‰¾åˆ°çš„å‡ åˆ™ä¸­æ–‡èµ„æ–™åè€Œæ›´æ¸…æ¥š

åŸåˆ™ä¸Šç¬¬ä¸€å±‚å’Œæœ€åä¸€å±‚éƒ½ä¸åº”é‡åŒ–ï¼Œä¸è¿‡æœ¬å®ç°å¿˜äº†è¿™ä»¶äº‹ï¼ˆæ‚²

reproduce

å…³äºdorefanetï¼šå®ƒå…³äºgrad quantçš„åŠæ³•ä»…åœ¨æ²¡æœ‰shortcutæ—¶æœ‰æ•ˆï¼ˆç„¶è€Œå®ƒresnet-dorefaçš„å®ç°é‡Œé¢è¿˜è£…ä½œæ— äº‹å‘ç”Ÿä¸€æ ·å–äº†nbits_Gå‚æ•°ğŸ˜…ï¼Œæ€ªä¸å¾—è®ºæ–‡é‡Œä¸ç”¨resnetè€Œç”¨è‡ªå»ºç½‘ç»œè®¨è®º

é™æ€æˆå‘˜å‡½æ•°ä¸éœ€è¦selfå‚æ•°ï¼Œä½†torchçš„è‡ªå®šä¹‰forwardæ–¹æ³•è‹¥ä¸ºé™æ€åˆ™å¿…é¡»æŠŠç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šä¸ºctxï¼ˆcontextï¼‰ï¼Œç”¨äºä¼ è¾“æœ‰ç”¨çš„ä¿¡æ¯